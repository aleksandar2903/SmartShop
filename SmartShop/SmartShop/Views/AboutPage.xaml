<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SmartShop.Views.AboutPage"
             x:Name="About"
             xmlns:vm="clr-namespace:SmartShop.ViewModels"
             xmlns:xct="http://xamarin.com/schemas/2020/toolkit"
             Shell.NavBarIsVisible="False"
             xmlns:local="clr-namespace:SmartShop" 
             xmlns:fontawesome="clr-namespace:SmartShop.Helpers" 
             x:DataType="vm:ItemsViewModel"
             xmlns:model="clr-namespace:SmartShop.Models" 
             xmlns:converters="clr-namespace:SmartShop.Helpers.Converters" 
             xmlns:buttons="clr-namespace:SmartShop.Components.Buttons"
             Visual="Material">


    <StackLayout BackgroundColor="White" VerticalOptions="FillAndExpand">

        <StackLayout VerticalOptions="FillAndExpand">

            <ActivityIndicator IsVisible="{Binding IsBusy}" IsRunning="{Binding IsBusy}" VerticalOptions="CenterAndExpand" HorizontalOptions="Center" Color="Black" HeightRequest="40" WidthRequest="40"></ActivityIndicator>


            <ScrollView VerticalScrollBarVisibility="{OnIdiom Desktop=Always, Phone=Never}" IsVisible="{Binding IsBusy, Converter={xct:InvertedBoolConverter}}">

                <StackLayout Padding="15, 0, 0, 25" Spacing="0">
                    <Grid Margin="-15,0, 0, 0">
                        <Image Source="wave1.png" Aspect="Fill" HeightRequest="90">
                        </Image>
                        <!--Top Search Bar-->
                        <StackLayout Padding="15" VerticalOptions="Start" HorizontalOptions="FillAndExpand" Orientation="Horizontal">
                            <StackLayout HorizontalOptions="FillAndExpand">
                                <ImageButton VerticalOptions="Center" WidthRequest="40" HeightRequest="40" CornerRadius="40" HorizontalOptions="Start" Aspect="AspectFit" BackgroundColor="White" Padding="10" Source="search.png" Command="{Binding OpenCategoriesPageCommand}"></ImageButton>
                            </StackLayout>
                            <StackLayout Orientation="Horizontal">
                                <StackLayout VerticalOptions="Center" Margin="0, 0, 5, 0">
                                    <Label TextColor="White" FontAttributes="Bold" Text="Hi, Aleksandar"></Label>
                                </StackLayout>
                                <Image
                            Aspect="AspectFit"
                            HeightRequest="40"
                            Source="avatar.png"
                            WidthRequest="40" />
                            </StackLayout>
                        </StackLayout>
                    </Grid>
                    <StackLayout
                                    Margin="0,20,0,20"
                                    HeightRequest="{OnIdiom Desktop=300, Phone=220}"
                                    Orientation="Horizontal">
                        <CollectionView ItemsSource="{Binding Features}" HorizontalOptions="FillAndExpand">

                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Horizontal"/>
                            </CollectionView.ItemsLayout>

                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="model:Image">
                                    <StackLayout>
                                        <Frame
                                                        BackgroundColor="#ededed"
                                                        Margin="0, 0, 15, 0"
                                                        Padding="0"
                                                        CornerRadius="20"
                                                        HasShadow="True"
                                                        IsClippedToBounds="False">
                                            <local:CustomFeatureImageFrame
                                                            HeightRequest="{OnIdiom Desktop=300, Phone=220}"
                                                            Aspect="AspectFill"
                                                            Source="{Binding Source}"/>
                                        </Frame>
                                    </StackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </StackLayout>
                    <!--  Categories  -->
                    <StackLayout Margin="0, 0, 0, 20">
                        <StackLayout Margin="0,0,0,5">
                            <Label
                                    FontAttributes="Bold"
                                    FontSize="18"
                                    Text="Top Categories"
                                    TextColor="Black">
                            </Label>

                            <StackLayout
                                    Margin="0,10,0,0"
                                    HeightRequest="{OnIdiom Desktop=150, Phone=90}"
                                    Orientation="Horizontal">
                                <CollectionView ItemsSource="{Binding Categories}" HorizontalOptions="FillAndExpand">

                                    <CollectionView.ItemsLayout>
                                        <LinearItemsLayout ItemSpacing="10" Orientation="Horizontal" />
                                    </CollectionView.ItemsLayout>

                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="model:Category">
                                            <StackLayout>

                                                <Frame
                                                        Margin="1,5,10,5"
                                                        Padding="0"
                                                        CornerRadius="30"
                                                        HasShadow="True"
                                                        BackgroundColor="White"  
                                                        HorizontalOptions="Center"
                                                        HeightRequest="{OnIdiom Desktop=100, Phone=60}"
                                                        IsClippedToBounds="False"
                                                        WidthRequest="{OnIdiom Desktop=100, Phone=60}">
                                                    <Image
                                                            Margin="15"
                                                            Aspect="AspectFit"
                                                            HorizontalOptions="Center"
                                                            Source="{Binding Img, StringFormat='{0}.png'}"
                                                            VerticalOptions="Center" />
                                                </Frame>
                                                <Label
                                                        FontSize="12"
                                                        HorizontalOptions="Center"
                                                        Text="{Binding Name}"
                                                        TextColor="Black">
                                                </Label>
                                                <!--<StackLayout.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ItemsViewModel}}, Path=ItemTapped}" />
                                                </StackLayout.GestureRecognizers>-->
                                            </StackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </StackLayout>
                        </StackLayout>
                    </StackLayout>

                    <!--  Top Products  -->
                    <StackLayout Margin="0, 0, 0, 20">
                        <StackLayout Margin="0,0,0,5">
                            <Label
                                    FontAttributes="Bold"
                                    FontSize="16"
                                    Text="Top Sellers"
                                    TextColor="Black">
                            </Label>

                            <StackLayout
                                    Margin="0,20,0,0"
                                    HeightRequest="{OnIdiom Desktop=300, Phone=220}"
                                    Orientation="Horizontal">
                                <CollectionView ItemsSource="{Binding Products}" HorizontalOptions="FillAndExpand">

                                    <CollectionView.ItemsLayout>
                                        <LinearItemsLayout ItemSpacing="10" Orientation="Horizontal"/>
                                    </CollectionView.ItemsLayout>

                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="model:Product">
                                            <StackLayout WidthRequest="130" Padding="10, 0" Margin="1,0,10,0">
                                                <Frame
                                                        BackgroundColor="#ededed"
                                                        Padding="10"
                                                        CornerRadius="10"
                                                        HasShadow="False"
                                                        HeightRequest="120"
                                                        IsClippedToBounds="False">
                                                    <Grid>
                                                        <Image
                                                            Aspect="AspectFit"
                                                            Source="{Binding Image1.Uri}" />
                                                        <buttons:FavouriteButton BindingContext="{Binding .}" Margin="0" WidthRequest="25" HeightRequest="25" VerticalOptions="Start" HorizontalOptions="End">
                                                        </buttons:FavouriteButton>
                                                    </Grid>
                                                </Frame>
                                                <StackLayout Orientation="Horizontal">
                                                    <StackLayout HorizontalOptions="FillAndExpand">
                                                        <Label
                                                        FontSize="12"
                                                        Text="{Binding Name}"
                                                        LineBreakMode="TailTruncation"
                                                        MaxLines="2"
                                                        TextColor="Black">
                                                        </Label>
                                                        <Label
                                                        FontSize="14"
                                                        Text="{Binding Price}"
                                                        TextColor="Black"
                                                            FontAttributes="Bold">
                                                        </Label>
                                                    </StackLayout>

                                                </StackLayout>
                                                <StackLayout.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ItemsViewModel}}, Path=ProductTapped}" CommandParameter="{Binding .}" />
                                                </StackLayout.GestureRecognizers>
                                            </StackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </StackLayout>
                        </StackLayout>
                    </StackLayout>

                    <!--  Top Products  -->
                    <StackLayout Margin="0, 0, 0, 20">
                        <StackLayout Margin="0,0,0,5">
                            <Label
                                    FontAttributes="Bold"
                                    FontSize="18"
                                    Text="Recommended For You"
                                    TextColor="Black">
                            </Label>

                            <StackLayout
                                    Margin="0,20,0,0"
                                    HeightRequest="{OnIdiom Desktop=300, Phone=250}"
                                    Orientation="Horizontal">
                                <CollectionView ItemsSource="{Binding FeatureProducts}" HorizontalOptions="FillAndExpand">

                                    <CollectionView.ItemsLayout>
                                        <LinearItemsLayout ItemSpacing="10" Orientation="Horizontal" />
                                    </CollectionView.ItemsLayout>

                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="model:Product">
                                            <StackLayout WidthRequest="160">
                                                <Frame
                                                        BackgroundColor="#ededed"
                                                        Margin="1,5,10,5"
                                                        Padding="0"
                                                        CornerRadius="20"
                                                        HasShadow="True"
                                                        IsClippedToBounds="False"
                                                        HeightRequest="200"
                                                        WidthRequest="150">
                                                    <Image
                                                            Aspect="AspectFit"
                                                            Source="{Binding Image1.Uri}" />
                                                </Frame>
                                                <StackLayout Orientation="Horizontal">
                                                    <StackLayout HorizontalOptions="FillAndExpand">
                                                        <Label
                                                        FontSize="16"
                                                        Text="{Binding Name}"
                                                        LineBreakMode="TailTruncation"
                                                        MaxLines="1"
                                                        TextColor="Black"
                                                        FontAttributes="Bold">
                                                        </Label>
                                                        <Label
                                                        FontSize="14"
                                                        Text="{Binding Price}"
                                                        TextColor="DarkGray">
                                                        </Label>
                                                    </StackLayout>
                                                    <buttons:FavouriteButton BindingContext="{Binding .}">
                                                    </buttons:FavouriteButton>
                                                </StackLayout>
                                                <StackLayout.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ItemsViewModel}}, Path=ProductTapped}" CommandParameter="{Binding .}" />
                                                </StackLayout.GestureRecognizers>
                                            </StackLayout>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </StackLayout>
                        </StackLayout>
                    </StackLayout>

                </StackLayout>
            </ScrollView>
        </StackLayout>
    </StackLayout>

</ContentPage>
